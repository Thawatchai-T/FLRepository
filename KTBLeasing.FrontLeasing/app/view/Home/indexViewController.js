/*
* File: app/view/Home/indexViewController.js
*
* This file was generated by Sencha Architect version 3.1.0.
* http://www.sencha.com/products/architect/
*
* This file requires use of the Ext JS 5.0.x library, under independent license.
* License of Sencha Architect does not include license for Ext JS 5.0.x. For more
* details see http://www.sencha.com/license or contact license@sencha.com.
*
* This file will be auto-generated each and everytime you save your project.
*
* Do NOT hand edit this file.
*/

Ext.define('TabUserInformation.view.Home.indexViewController', {
    extend: 'Ext.app.ViewController',
    alias: 'controller.homeindex',

    requires: [
        'TabUserInformation.view.Home.indexViewModel'
    ],

    fnLogOut: function () {
        sessionStorage.clear();

        this.getView().destroy();

        Ext.create('widget.windowloginwindow').show();
    },

    onMainViewBeforeRender: function (component, eOpts) {
        //console.log(eOpts);
        var viewport = component.down('tabpanel'),
        userid = sessionStorage.getItem('UserId'),
        store = this.getStore('userinfoStore'),
        title;

        viewport.removeAll();

        //var userid = sessionStorage.getItem('UserId');

        //var store = this.getStore('userinfoStore');

        store.getProxy().setExtraParam("userid", userid);

        store.load({
            scope: this,
            callback: function (records, operation, success) {
                // the operation object
                // contains all of the details of the load operation
                title = "<b>ยินดีต้อนรับคุณ</b> ";
                title += records[0].get('UserInfo').FirstNameTh + "  ";
                title += records[0].get('UserInfo').LastNameTh + "  ";
                title += "<b>ตำแหน่งงาน</b> ";
                title += records[0].get('UserInfo').Position.Name + "  ";
                title += "<b>วันที่เข้าสู่ระบบ</b> ";
                title += Ext.Date.format(new Date(), 'd/m/Y') + "  ";
                title += '<a href="Home/Logout">LogOut</a>';

                //                console.log(records[0].get('UserInfo'));

                //                console.log(records[0]);
                sessionStorage.setItem('UserData', Ext.encode(records[0].data));

                viewport.setTitle(title);

                var ltab = records[0].get('TabMdelList');

                //                console.log(ltab);

                for (i = 0; i < ltab.length; i++) {
                    viewport.add(Ext.widget(ltab[i].Widget));
                }

                if (ltab.length > 0) viewport.setActiveTab(0);

            }
        });

        //var loginmodel =  Ext.decode(sessionStorage.getItem('UserModel')).data;
        //var store = Ext.getStore('tabInRoles');

        //var name = "ยินดีต้อนคุณ "+loginmodel.TitleName+loginmodel.FirstName+"  "+loginmodel.LastName+" ",
        //    position = "Position: "+loginmodel.Position+" ",
        //    date ="วันที่: "+new Date();

        //var viewport = component.down('tabpanel');
        ////remvoe
        //viewport.removeAll();
        //debugger;
        ////mockup
        //viewport.setTitle("Thawatchai Tipkote position: GB");
        //viewport.add(Ext.widget('tabauthorizetab'));
        //viewport.add(Ext.widget('tabuserinftab'));
        ////viewport.setTitle(name+position+date);
        ////store
        //allRecords = store.data;
        //allRecords.each( function(record){

        //    //console.log(record);
        //    //    //add tab by role
        //       //viewport.add(Ext.widget(record.get('Widget')));
        //    //    //viewport.add(Ext.widget(record.get('TabName')));

        //    //});

        //    //setActiveTab default index 0
        //    //viewport.setActiveTab(0);

        //    viewport.show();
        //}



    },

    onButtonLogoutClick: function (button, e, eOpts) {
        this.fnLogOut();
    }
});
