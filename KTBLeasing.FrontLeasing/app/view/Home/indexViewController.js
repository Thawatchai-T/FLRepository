/*
* File: app/view/Home/indexViewController.js
*
* This file was generated by Sencha Architect version 3.1.0.
* http://www.sencha.com/products/architect/
*
* This file requires use of the Ext JS 5.0.x library, under independent license.
* License of Sencha Architect does not include license for Ext JS 5.0.x. For more
* details see http://www.sencha.com/license or contact license@sencha.com.
*
* This file will be auto-generated each and everytime you save your project.
*
* Do NOT hand edit this file.
*/

Ext.define('TabUserInformation.view.Home.indexViewController', {
    extend: 'Ext.app.ViewController',
    alias: 'controller.homeindex',

    fnLogOut: function () {
        sessionStorage.clear();

        Ext.create('widget.windowloginwindow');

        this.getView().destroy();
    },

    onMainViewBeforeRender: function (component, eOpts) {
        var me = this,
        viewport = component.down('tabpanel'),
        userid = sessionStorage.getItem('UserId'),
        store = this.getStore('userinfoStore'),
        title;

        viewport.removeAll();

        store.getProxy().setExtraParam("userid", userid);

        store.load({
            scope: this,
            callback: function (records, operation, success) {
                sessionStorage.setItem('UserData', Ext.encode(records[0].data));

                var ltab = records[0].get('TabMdelList');

                for (i = 0; i < ltab.length; i++) {
                    viewport.add(Ext.widget(ltab[i].Widget));
                }

                if (ltab.length > 0) {
                    viewport.setActiveTab(0);

                    title = "<b>ยินดีต้อนรับคุณ</b> ";
                    title += records[0].get('UserInfo').FirstNameTh + "  ";
                    title += records[0].get('UserInfo').LastNameTh + "  ";
                    title += "<b>ตำแหน่งงาน</b> ";
                    title += records[0].get('UserInfo').Position.Name + "  ";
                    title += "<b>วันที่เข้าสู่ระบบ</b> ";
                    title += Ext.Date.format(new Date(), 'd/m/Y') + "  ";

                    var html = '<span style="color:white;font:status-bar;"><b>'
                    + 'ยินดีต้อนรับ! </br>'
                    + 'คุณ ' + records[0].get('UserInfo').FirstNameTh + ' ' + records[0].get('UserInfo').LastNameTh + ' <br/>'
                    + 'ตำแหน่งงาน : ' + records[0].get('UserInfo').Position.Name + ' </span>'

                } else {
                    Ext.Msg.show({
                        title: 'Warning',
                        message: 'คุณไม่มีสิทธิในการใช้งานระบบ',
                        buttons: Ext.Msg.OK,
                        icon: Ext.Msg.WARNING,
                        fn: function (btn, value) {
                            if (btn == 'ok') {
                            }
                        }
                    });
                }

                //title += '<a href="Home/Logout">LogOut</a>';

                viewport.down('#titleShowName').setHtml(html);
            }
        });
    },

    onButtonLogoutClick: function (button, e, eOpts) {
        this.fnLogOut();
    }
});
