/*
 * File: app/view/Window/LoginWindowViewController.js
 *
 * This file was generated by Sencha Architect version 3.1.0.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 5.0.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 5.0.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('TabUserInformation.view.Home.LoginWindowViewController', {
    extend: 'Ext.app.ViewController',
    alias: 'controller.windowloginwindow',

    onAfterRender: function (component, eOpts) {
        component.down('form').getForm().findField('UserName').focus();
    },

    onLoginClick: function (button, e, eOpts) {
        this.fnLogin();
    },

    onSpecialKey: function (field, e) {
        if (e.getKey() == e.ENTER) {
            this.fnLogin();
        }
    },

    fnLogin: function(){
        var Me = this.getView();
        var form = this.getView().down('form').getForm();
        // debugger;
        if (form.isValid()) {
            form.submit({
                url: 'api/login/dologin',
                type: 'POST',
                timeout: 99999,
                success: function (form, action) {
                    if (action.response.responseText.status) {
                        Ext.Msg.alert('Success', action.response.responseText);
                    }

                    if (action.response.statusText === "OK" && action.response.statusText !== "") {

                        sessionStorage.setItem("FLSystem", true);
                        sessionStorage.setItem("UserId", Ext.getCmp('username').getValue());
                        Me.close();

                        // Add the main view to the viewport
                        Ext.widget('homeindex');
                    } else {
                        sessionStorage.setItem("LoggedIn", false);
                        //fix Authentication Bypass
                        Ext.widget('homeindex');
                    }


                    //Ext.widget('homeindex');
                },
                failure: function (form, action) {

                    Ext.Msg.alert('Login Status', Ext.decode(action.response.responseText));
                }

            });
        }
    }
});
