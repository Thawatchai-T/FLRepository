/*
* File: app/view/Window/UserInfWindowViewController.js
*
* This file was generated by Sencha Architect version 3.1.0.
* http://www.sencha.com/products/architect/
*
* This file requires use of the Ext JS 5.0.x library, under independent license.
* License of Sencha Architect does not include license for Ext JS 5.0.x. For more
* details see http://www.sencha.com/license or contact license@sencha.com.
*
* This file will be auto-generated each and everytime you save your project.
*
* Do NOT hand edit this file.
*/

Ext.define('TabUserInformation.view.User.UserInfWindowViewController', {
    extend: 'Ext.app.ViewController',
    alias: 'controller.windowuserinfwindow',

    onButtonSaveClick: function (button, e, eOpts) {

        var status = false;

        var form = this.getView().down('form').getForm();

        if (form.isValid()) {
            Ext.MessageBox.confirm('Confirm', 'คุณต้องการที่บันทึกหรือเปลื่ยนแปลงข้อมูล?',
                function (cbtn, bool) {
                    if (cbtn == 'yes') {
                        form.submit({
                            url: 'api/UserInfo/DoPost',
                            success: function (form, action) {
                                console.log(action);
                                Ext.Msg.alert('Success', "บันทึกข้อมูลเรียบร้อย");

                                Ext.getCmp('pagingtoolbar-userinf').moveFirst();
                                
                                button.up('window').close();
                                
                            },
                            failure: function (form, action) {
                                Ext.Msg.alert('Failed', 'กรุณาตรวจสอบว่า ชื่อผู้ใช้มีอยู่ในระบบ? FristName_LastName(2)');
                            }
                        });
                    }
                   
                }
            );

        } else {
            Ext.Msg.alert('Data is not valid!', 'กรุณาเลือกข้อมูลให้ครบถ้วน');
        }
        
    },

    onButtonResetClick: function (button, e, eOpts) {
        this.getView().getComponent('userinfform').getForm().reset();
    },

    onPost: function (data) {
        Ext.Ajax.request({
            url: 'api/UserInfo/dopost',
            method: 'post',
            params: {
                id: 'test'
            },
            contentType: "text/plain; charset=UTF-8",
            success: function (response) {
                console.log(response);
                var jsonResp = Ext.util.JSON.decode(response.responseText);
                if (jsonResp.success == true) {
                    //                    if (action == "insert")
                    //                        Ext.Msg.alert("Info", "ทำการเพิ่มข้อมูลเรียบร้อยแล้ว");
                    //                    else if (action == "update")
                    //                        Ext.Msg.alert("Info", "ทำการแก้ไขข้อมูลเรียบร้อยแล้ว");
                    Ext.Msg.alert("Info", "ทำการแก้ไขข้อมูลเรียบร้อยแล้ว");
                    //Ext.getCmp('tree-setup').getStore().load();
                } else {
                    Ext.Msg.alert("Info", "notsave");

                }
            },
            failure: function (response) {
                console.log(response);
                var jsonResp = Ext.util.JSON.decode(response.responseText);
                Ext.Msg.alert("Error", jsonResp.error);
            }
        });
    }

});
